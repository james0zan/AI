httpd-2.4.6

# Native
mkdir -p install/native

CC=clang CFLAGS="-O0 -g -w" ./configure --prefix=/root/ai/performance/http/httpd-2.4.6/install/native --with-mpm=worker --with-pcre=/usr/local/pcre

# Trace
trace

chmod a+w ./configure
Add 
  EXTRA_CFLAGS=""
To ./configure
At Line 32290
Before
  if test "x$silent" != "xyes"; then

chmod a+w build/rules.mk.in 
Change the rule of .c.lo to

.c.lo:
  $(CC) $(ALL_CFLAGS) $(ALL_CPPFLAGS) $(ALL_INCLUDES) -emit-llvm -c $<
  # llvm-dis <$(patsubst %.c, %.bc, $<) >$(patsubst %.c, %.ll, $<)
  opt -load=/root/ai/ai/build/llvm/AI/LLVMAIMarkTheAccesses.so -AIMarkTheAccesses <$(patsubst %.c, %.bc, $<) >$(patsubst %.c, %-AIMarkTheAccesses.bc, $<)
  opt -load=/root/ai/ai/build/llvm/AI/LLVMAITrace.so -AITrace <$(patsubst %.c, %-AIMarkTheAccesses.bc, $<) >$(patsubst %.c, %-AITrace.bc, $<)
  llc $(patsubst %.c, %-AITrace.bc, $<) -o $(patsubst %.c, %.s, $<)
  $(LIBTOOL) --mode=compile $(CC) $(PICFLAGS) $(LTCFLAGS) -c $(patsubst %.c, %.s, $<) && touch $@

.s.lo:
  $(LT_COMPILE)

.c.slo:
  $(CC) $(ALL_CFLAGS) $(ALL_CPPFLAGS) $(ALL_INCLUDES) -emit-llvm -c $<
  # llvm-dis <$(patsubst %.c, %.bc, $<) >$(patsubst %.c, %.ll, $<)
  opt -load=/root/ai/ai/build/llvm/AI/LLVMAIMarkTheAccesses.so -AIMarkTheAccesses <$(patsubst %.c, %.bc, $<) >$(patsubst %.c, %-AIMarkTheAccesses.bc, $<)
  opt -load=/root/ai/ai/build/llvm/AI/LLVMAITrace.so -AITrace <$(patsubst %.c, %-AIMarkTheAccesses.bc, $<) >$(patsubst %.c, %-AITrace.bc, $<)
  llc $(patsubst %.c, %-AITrace.bc, $<) -o $(patsubst %.c, %.s, $<)
  $(LIBTOOL) --mode=compile $(CC) -DLINUX -D_REENTRANT -D_GNU_SOURCE  $(ALL_INCLUDES) $(SHLTCFLAGS) -c $< && touch $@


export LD_LIBRARY_PATH=/root/ai/ai/build/ai-rt/:$LD_LIBRARY_PATH
export LIBRARY_PATH=/root/ai/ai/build/ai-rt/:LIBRARY_PATH
CC=clang CFLAGS="-O0 -g -w" LIBS="-lai -lpthread" LDFLAGS="-lai -lpthread" ./configure --prefix=/root/ai/performance/http/httpd-2.4.6/install/trace --with-mpm=worker  --with-pcre=/usr/local/pcre


cd install/
/root/ai/ai/build/tools/num-server httpd.AccessesInfo

bin/httpd -X
httperf --server 127.0.0.1 \
        --port 7690 \
        --uri / \
        --rate 100 \
        --num-conn 2000 \
        --num-call 1 \
        --timeout 5


.c.lo:
  $(CC) $(ALL_CFLAGS) $(ALL_CPPFLAGS) $(ALL_INCLUDES) -emit-llvm -c $<
  # llvm-dis <$(patsubst %.c, %.bc, $<) >$(patsubst %.c, %.ll, $<)
  opt -load=/root/ai/ai/build/llvm/AI/LLVMAIMarkTheAccesses.so -AIMarkTheAccesses <$(patsubst %.c, %.bc, $<) >$(patsubst %.c, %-AIMarkTheAccesses.bc, $<)
  opt -load=/root/ai/ai/build/llvm/AI/LLVMAITolerate.so -AITolerate -AISanitizedBSetFile=/root/ai/performance/http/httpd-2.4.6/install/trace/BSet.TXT.Sanitized <$(patsubst %.c, %-AIMarkTheAccesses.bc, $<) >$(patsubst %.c, %-AITolerate.bc, $<)
  llc $(patsubst %.c, %-AITolerate.bc, $<) -o $(patsubst %.c, %.s, $<)
  $(LIBTOOL) --mode=compile $(CC) $(PICFLAGS) $(LTCFLAGS) -c $(patsubst %.c, %.s, $<) && touch $@

.s.lo:
  $(LT_COMPILE)

.c.slo:
  $(CC) $(ALL_CFLAGS) $(ALL_CPPFLAGS) $(ALL_INCLUDES) -emit-llvm -c $<
  # llvm-dis <$(patsubst %.c, %.bc, $<) >$(patsubst %.c, %.ll, $<)
  opt -load=/root/ai/ai/build/llvm/AI/LLVMAIMarkTheAccesses.so -AIMarkTheAccesses <$(patsubst %.c, %.bc, $<) >$(patsubst %.c, %-AIMarkTheAccesses.bc, $<)
  opt -load=/root/ai/ai/build/llvm/AI/LLVMAITolerate.so -AITolerate -AISanitizedBSetFile=/root/ai/performance/http/httpd-2.4.6/install/trace/BSet.TXT.Sanitized <$(patsubst %.c, %-AIMarkTheAccesses.bc, $<) >$(patsubst %.c, %-AITolerate.bc, $<)
  llc $(patsubst %.c, %-AITolerate.bc, $<) -o $(patsubst %.c, %.s, $<)
  $(LIBTOOL) --mode=compile $(CC) -DLINUX -D_REENTRANT -D_GNU_SOURCE  $(ALL_INCLUDES) $(SHLTCFLAGS) -c $< && touch $@

export LD_LIBRARY_PATH=/root/ai/ai/build/ai-rt/:$LD_LIBRARY_PATH
export LIBRARY_PATH=/root/ai/ai/build/ai-rt/:LIBRARY_PATH
CC=clang CFLAGS="-O0 -g -w" LIBS="-lai -lpthread" LDFLAGS="-lai -lpthread" ./configure --prefix=/root/ai/performance/http/httpd-2.4.6/install/tolerate --with-mpm=worker  --with-pcre=/usr/local/pcre

===========
# Dependencies
wget http://apache.spd.co.il/apr/apr-1.4.8.tar.gz
tar -xzf apr-1.4.8.tar.gz
rm apr-1.4.8.tar.gz
cd apr-1.4.8/
./configure
make
make install

wget http://apache.spd.co.il/apr/apr-util-1.5.2.tar.gz
tar xzf apr-util-1.5.2.tar.gz
rm apr-util-1.5.2.tar.gz
cd apr-util-1.5.2/
./configure --prefix=/usr/local/apr-util --with-apr=/usr/local/apr
make
make install

tar xvf pcre-8.33.tar.bz2 
cd pcre-8.33/
./configure --prefix=/usr/local/pcre
make
make install

./configure --prefix=/root/ai/performance/http/install --with-apr=/usr/local/apr --with-apr-util=/usr/local/apr-util --with-pcre=/usr/local/pcre